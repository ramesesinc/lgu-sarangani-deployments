import com.rameses.common.*;
import com.rameses.annotations.*;

class SaranganiPaymentOrderInterceptor {
	@Service('SequenceService')
	def seqSvc

	@Service('DateService')
	def dtSvc

	@DataContext('lgu_po')
	def em

	@Before(pattern="PersistenceService.create",
			eval="#{args[0]._schemaname=='lgu_po'}")
	public void beforeCreate(ei) {
		def po = ei.args[0]
		po.txnno = seqSvc.getNextFormattedSeries('lgu-po')
		po.txndate = dtSvc.getServerDate()
	}

	@After(pattern="CashReceiptService.post",
			eval="#{args[0].collectiontype?.handler=='lgu_po'}")
	public void afterReceiptPost(ei) {
		def po = ei.args[0].po
		em.find([objid: po.objid]).update([state:'PAID'])
	}
}