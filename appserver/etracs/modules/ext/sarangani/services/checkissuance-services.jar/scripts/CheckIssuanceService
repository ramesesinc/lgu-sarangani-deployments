import com.rameses.common.*;
import com.rameses.annotations.*;
import com.rameses.services.extended.*;

class CheckIssuanceService {
	@DataContext('checkissuance')
	def em

	@DataContext('checkbook')
	def cb

	@ProxyMethod
	public def approve(checkissuance){
		//change checkissuance state to APPROVED
		checkissuance.state = 'APPROVED'
		em.update(checkissuance)
	
		//increment checkbook series and update state
		def checkbook = cb.find([objid: checkissuance.checkbook.objid])
							.first()

		checkbook.currentseries += 1
		if (checkbook.currentseries > checkbook.endseries){
			checkbook.state = 'CONSUMED'
		}
		cb.update(checkbook)
		return checkissuance
	}
}